name: Run Scandium Script

on:
  workflow_dispatch:  # Only manual trigger of the workflow
    inputs:
      max_attempts:
        description: 'Maximum polling attempts (default: 30)'
        required: false
        default: '30'
        type: string
      retry_count:
        description: 'Number of retry attempts (default: 0)'
        required: false
        default: '0'
        type: string
      wait_period:
        description: 'Seconds between polling attempts (default: 120)'
        required: false
        default: '120'
        type: string
      browser:
        description: 'Browser to use (chrome, firefox, edge)'
        required: false
        default: 'chrome'
        type: string
      STARTING_URL:
        description: 'Starting URL'
        required: false
        default: 'https://www.google.com'
        type: string

jobs:
  execute-scandium-script:
    runs-on: ubuntu-latest

    env:
      API_TOKEN: ${{ secrets.API_TOKEN }}
      PROJECT_ID: ${{ secrets.PROJECT_ID }}
      HUB_URL: ${{ secrets.HUB_URL }}
      STARTING_URL: ${{ inputs.STARTING_URL }}
      SUITE_ID: ${{ secrets.SUITE_ID }}
      BROWSER: ${{ inputs.browser }}
      SCREENSHOT: true
      VARIABLES: '{}'
      RETRY: ${{ inputs.retry_count }}
      MAX_ATTEMPTS: ${{ inputs.max_attempts }}
      WAIT_PERIOD: ${{ inputs.wait_period }}

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install jq
        run: |
          sudo apt-get update
          sudo apt-get install -y jq

      - name: Download the Scandium Bash Script
        run: |
          SCRIPT_URL="https://raw.githubusercontent.com/GetScandium/files/refs/heads/main/scandium_script.sh"
          curl -o scandium_script.sh $SCRIPT_URL
          chmod +x scandium_script.sh

      - name: Run the Scandium Script
        run: |
          ./scandium_script.sh 